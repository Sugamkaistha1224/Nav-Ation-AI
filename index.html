<!DOCTYPE html>
<html>
<head>
     <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet" />

     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">
     <style type="text/css">
          @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap");
:root {
     --text-color:#edf3ff;
     --subheading-color:#97a7ca;
     --placeholder-color:#c3cdde;
     --primary-color:#101623;
     --secondary-color:#283045;
     --secondary-hover-color:#333e58;
     --scrollbar-color:#626a7f;
}
* {
     margin: 0px;
     padding: 0px;
     box-sizing: border-box;
     font-family: 'Poppins',sans-serif;
}
body {
     background-color: var(--primary-color);
     color: var(--text-color);
}
body.light-theme {
     --text-color:#090c13;
     --subheading-color:#7b8cae;
     --placeholder-color:#606982;
     --primary-color:#f3f7ff;
     --secondary-color:#dce6f9;
     --secondary-hover-color:#d2ddf2;
     --scrollbar-color:#a2aac2;
}
.container {
     overflow-y: auto;
     padding: 32px 0px 60px;
     height: calc(100vh - 127px);
     scrollbar-color: var(--scrollbar-color) transparent;
}
.container :where(.application-header,.suggestions,.message,.prompt-wrapper) {
     position: relative;
     margin: 0px auto;
     padding: 0px 20px;
     width: 100%;
     max-width: 990px;
}
.container .application-header {
     margin-top: 3vh;
}
.container .application-header .heading {
     width: fit-content;
     font-size: 3rem;
     background-image: linear-gradient(to right,#1d7efd,#8f6fff);
     text-transform: capitalize;
     -webkit-text-fill-color: transparent;
     -webkit-background-clip: text;
     background-clip: text;
}
.container .application-header .sub-heading {
     font-size: 2.6rem;
     margin-top: -5px;
     color: var(--subheading-color);
     text-transform: capitalize;
}
.container .suggestions {
     width: 100%;
     list-style: none;
     display: flex;
     gap: 15px;
     margin-top: 9.5vh;
     overflow-x: auto;
     scroll-snap-type: x mandatory;
     scrollbar-width: none;
}
body.chats-active .container :where(.application-header,.suggestions) {
     display: none;
}
.container .suggestions .suggestions-item {
     cursor: pointer;
     padding: 18px;
     width: 228px;
     display: flex;
     flex-shrink: 0;
     flex-direction: column;
     align-items: flex-end;
     justify-content: space-between;
     scroll-snap-align: center;
     text-transform: capitalize;
     border-radius: 12px;
     background-color: var(--secondary-color);
     transition: 0.3s ease;
}
.container .suggestions .suggestions-item:hover {
     background-color: var(--secondary-hover-color);
}
.container .suggestions .suggestions-item .text {
     font-size: 1.1rem;
}
.container .suggestions .suggestions-item .icon {
     width: 45px;
     height: 45px;
     display: flex;
     align-items: center;
     align-self: flex-end;
     justify-content: center;
     font-size: 1.4rem;
     margin-top: 35px;
     border-radius: 50%;
     background-color: var(--primary-color);
     color:#1d7efd;
}
.container .suggestions .suggestions-item:nth-child(2) .icon {
     color:#28a745;
}
.container .suggestions .suggestions-item:nth-child(3) .icon {
     color:#ffc107;
}
.container .suggestions .suggestions-item:nth-child(4) .icon {
     color:#6f42c1;
}
.container .chats-container {
     display: flex;
     gap: 20px;
     flex-direction: column;
}
.container .chats-container .message {
     display: flex;
     gap: 11px;
     align-items: center;
}
.container .chats-container .message .avatar {
     width: 43px;
     height: 43px;
     flex-shrink: 0;
     align-self: flex-start;
     border-radius: 50%;
     padding: 6px;
     margin-right: -7px;
     background: var(--secondary-color);
     border: 1px solid var(--secondary-hover-color);
}
.container .chats-container .message.loading .avatar {
     animation: rotate 3s linear infinite;
}
@keyframes rotate {
     100% {transform: rotate(360deg);}
}
.container .chats-container .message .message-text {
     padding: 3px 16px;
     word-wrap: break-word;
     white-space: pre-line;
}
.container .chats-container .bot-message {
     margin: 9px auto;
}
.container .chats-container .user-message {
     flex-direction: column;
     align-items: flex-end;
}
.container .chats-container .user-message .message-text {
     padding: 12px 16px;
     max-width: 75%;
     background: var(--secondary-color);
     border-radius: 13px 13px 3px 13px;
}
.container .chats-container .user-message .image-attachment {
     margin-top: -7px;
     width: 50%;
     border-radius: 13px 3px 13px 13px;
}
.container chats-container .user-message .file-attachment {
     display: flex;
     align-items: center;
     gap: 6px;
     margin-top: -7px;
     padding: 10px;
     border-radius: 13px 3px 13px 13px;
     background-color: var(--secondary-color);
}
.container .chats-container .user-message .file-attachment span {
     color:#1d7efd;
}
.container .prompt-container {
     position: fixed;
     left: 0%;
     bottom: 0%;
     width: 100%;
     padding: 16px 0px;
     background-color: var(--primary-color);
}
.prompt-container :where(.prompt-wrapper,.prompt-form,.prompt-actions) {
     display: flex;
     align-items: center;
     gap: 12px;
     height: 56px;
}
.prompt-container .prompt-form {
     height: 100%;
     width: 100%;
     border-radius: 130px;
     background-color: var(--secondary-color);
}
.prompt-form .prompt-input {
     width: 100%;
     height: 100%;
     background: none;
     color: var(--text-color);
     border: none;
     outline: none;
     font-size: 1rem;
     padding-left: 24px;
}
.prompt-form .prompt-input::placeholder {
     color: var(--placeholder-color);
}
.prompt-wrapper button {
     width: 56px;
     height: 100%;
     flex-shrink: 0;
     cursor: pointer;
     font-size: 1.4rem;
     border: none;
     border-radius: 50%;
     background-color: var(--secondary-color);
     color: var(--text-color);
     transition: 0.3s ease;
}
.prompt-wrapper :is(button:hover,#cancel-file-button,.file-icon) {
     background-color: var(--secondary-hover-color);
}
.prompt-form .prompt-actions {
     gap: 5px;
     margin-right: 7px;
}
.prompt-wrapper .prompt-form :where(.file-upload-wrapper,button,img) {
     position: relative;
     height: 45px;
     width: 45px;
}
.prompt-form .prompt-actions #send-prompt-button {
     background-color:#1d7efd;
     color:#fff;
     display: none;
}
.prompt-form .prompt-input:valid~.prompt-actions #send-prompt-button {
     display: block;
}
.prompt-form #send-prompt-button:hover {
     background-color:#0264e3;
}
.prompt-form .file-upload-wrapper :where(button,img) {
     display: none;
     border-radius: 50%;
     object-fit: cover;
     position: absolute;
}
.prompt-form .file-upload-wrapper.active #add-file-button {
     display: none;
}
.prompt-form .file-upload-wrapper #add-file-button,
.prompt-form .file-upload-wrapper.active.image-attached img,
.prompt-form .file-upload-wrapper.active.file-attached .file-icon,
.prompt-form .file-upload-wrapper.active:hover #cancel-file-button {
     display: block;
}
.prompt-form :is(#stop-response-button:hover,#cancel-file-button) {
     color:#d62939;
}
.prompt-wrapper .prompt-form .file-icon {
     color:#1d7efd;
}
.prompt-form #stop-response-button,body.bot-responding .prompt-form .file-upload-wrapper {
     display: none;
}
body.bot-responding .prompt-form #stop-response-button {
     display: block;
}
.prompt-container .disclaimer-text {
     font-size: 0.9rem;
     text-align: center;
     padding: 16px 20px 0px;
     color: var(--placeholder-color);
}
@media only screen and (max-width:768px){
     .container {
          padding: 20px 0px 100px;
     }
     .application-header :is(.heading,.sub-heading) {
          font-size: 2rem;
          line-height: 1.4;
     }
     .application-header .sub-heading {
          font-size: 1.7rem;
     }
     .container .chats-container {
          gap: 15px;
     }
     .chats-container .bot-message {
          margin: 4px auto;
     }
     .prompt-container :where(.prompt-wrapper,.prompt-form,.prompt-actions) {
          gap: 8px;
          height: 53px;
     }
     .prompt-container button {
          width: 53px;
     }
     .prompt-form :is(.file-upload-wrapper,button,img) {
          height: 42px;
          width: 42px;
     }
     .prompt-form .prompt-input {
          padding-left: 20px;
     }
     .prompt-form .file-upload-wrapper.active #cancel-file-button {
          opacity: 0;
     }
     .prompt-wrapper.hide-controls :where(#theme-toggle-button,#delete-chats-button) {
          display: none;
     }
}

.logo-container {
    position: absolute;
    top: 10px;
    left: 10px;
}

.logo {
    width: 120px; /* Adjust size as needed */
    height: auto;
}

 .logo-container {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
        }
        .logo {
            width: 120px;
            height: auto;
        }

        .container {
            overflow-y: auto;
            padding: 32px 0px 60px;
            height: calc(100vh - 127px);
            scrollbar-color: var(--scrollbar-color) transparent;
        }
        .container .application-header {
            margin-top: 3vh;
            text-align: center;
        }
        .container .application-header .heading {
            font-size: 3rem;
            background-image: linear-gradient(to right, #1d7efd, #8f6fff);
            -webkit-text-fill-color: transparent;
            -webkit-background-clip: text;
        }
        .container .application-header .sub-heading {
            font-size: 2.6rem;
            color: var(--subheading-color);
        }

        /* Chat input area */
        .prompt-container {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            padding: 16px 0px;
            background-color: var(--primary-color);
        }
        .prompt-form {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 12px;
            height: 56px;
            background-color: var(--secondary-color);
            border-radius: 130px;
            padding-left: 24px;
        }
        .prompt-input {
            width: 100%;
            background: none;
            color: var(--text-color);
            border: none;
            outline: none;
            font-size: 1rem;
        }
        .prompt-input::placeholder {
            color: var(--placeholder-color);
        }
        .prompt-form button {
            width: 56px;
            height: 100%;
            border-radius: 50%;
            border: none;
            background-color: var(--secondary-color);
            color: var(--text-color);
            cursor: pointer;
            font-size: 1.4rem;
            transition: 0.3s ease;
        }
        .prompt-form #send-prompt-button {
            background-color: #1d7efd;
            color: #fff;
        }
        .prompt-form #send-prompt-button:hover {
            background-color: #0264e3;
        }

        /* Responsive Adjustments */
        @media only screen and (max-width: 768px) {
            .container {
                padding: 20px 0px 100px;
            }
            .application-header .heading {
                font-size: 2rem;
            }
            .application-header .sub-heading {
                font-size: 1.7rem;
            }
            .prompt-form {
                height: 53px;
                padding-left: 20px;
            }
            .prompt-form button {
                width: 50px;
            }
            .logo {
                width: 100px;
            }




     </style>
</head>
<body>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
<div class="logo-container">
        <img src="https://sugamimage.carrd.co/assets/images/image36.png?v=f7f20d18" alt="Nav-Ation Logo" class="logo">
    </div>
    <style type="text/css">
         /* 3-dot menu */
    .three-dot-menu {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 24px;
      height: 24px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
      z-index: 1001;
    }

    .three-dot-menu span {
      height: 4px;
      width: 100%;
      background-color: white;
      border-radius: 2px;
    }

    /* Popup Panel */
    .feature-popup {
      position: fixed;
      top: 0;
      right: -350px;
      width: 320px;
      height: 100%;
      background: linear-gradient(145deg, #1e1e2f, #0d0d1a);
      padding: 20px;
      box-shadow: -5px 0 15px rgba(0,0,0,0.7);
      transition: right 0.4s ease;
      z-index: 1000;
      border-left: 1px solid rgba(255, 255, 255, 0.1);
    }

    .feature-popup.open {
      right: 0;
    }

    .close-popup {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #333;
      border: none;
      color: white;
      padding: 5px 10px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }

    .popup-content h2 {
      margin-top: 40px;
      font-size: 20px;
      margin-bottom: 20px;
      color: #fff;
    }

    .feature-boxes {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .feature-card {
      background-color: #2a2a3d;
      padding: 15px;
      border-radius: 10px;
      text-decoration: none;
      color: white;
      transition: background 0.3s, transform 0.2s;
      border: 1px solid #444;
    }

    .feature-card:hover {
      background-color: #353552;
      transform: translateY(-2px);
    }

    .feature-card h3 {
      margin: 0 0 8px;
    }

    .feature-card p {
      margin: 0;
      font-size: 14px;
      color: #ccc;
    }
    </style>
<!-- 3-dot menu -->
  <div class="three-dot-menu" onclick="togglePopup()">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <!-- Popup -->
  <div class="feature-popup" id="featurePopup">
    <button class="close-popup" onclick="togglePopup()">‚úñ</button>
    <div class="popup-content">
      <h2>Explore Zen AI Features</h2>
      <div class="feature-boxes">
          <a href="https://sugam-kaistha-kgs.w3spaces.com/Nav-Ation-About.html" target="_blank" class="feature-card">
          <h3>ü§ñ Nav-Ation Offical Page</h3>
          <p>Details About Nav-Ation ( Zen-AI ).</p>
        </a>
        <a href="https://sugam-kaistha-kgs.w3spaces.com/Nav-Ation-AI-Image-Gen.html" target="_blank" class="feature-card">
          <h3>üß† Nav-Ation AI Image Gen</h3>
          <p>Create AI-generated images with ease.</p>
        </a>
        <a href="https://sugam-kaistha-kgs.w3spaces.com/ZEN-A-Soil-Detection.html" target="_blank" class="feature-card">
          <h3>üå± Soil Detection by AI</h3>
          <p>Smart soil quality scanning.</p>
        </a>
        <a href="https://sugam-kaistha-kgs.w3spaces.com/Zen-AI-Weather-App.html" target="_blank" class="feature-card">
          <h3>‚òÅÔ∏è Weather Detection with Zen AI</h3>
          <p>Accurate AI-powered weather insights.</p>
        </a>

        <a href="https://sugam-kaistha-kgs.w3spaces.com/Sugam-OS-World.html" target="_blank" class="feature-card">
          <h3>ü§ñ Sugam OS Eniroment</h3>
          <p>Online cloud os Enviroment.</p>
        </a>
      </div>
    </div>
  </div>
  <script>
    function togglePopup() {
      const popup = document.getElementById('featurePopup');
      popup.classList.toggle('open');
    }
  </script>

<div class="container">
          <header class="application-header">
               <h1 class="heading">hello, there</h1>
               <h4 class="sub-heading">how can i help you today?</h4>
          </header>
          <ul class="suggestions">
    <li class="suggestions-item">
        <p class="text">What is ‡§®‡§µ-Ation? </p>
        <span class="icon material-symbols-rounded">draw</span>
    </li>
    <li class="suggestions-item">
        <p class="text">What is Innovations?</p>
        <span class="icon material-symbols-rounded">lightbulb</span>
    </li>
    <li class="suggestions-item">
        <p class="text">What is Zen AI?</p>
        <span class="icon material-symbols-rounded">explore</span>
    </li>
    <li class="suggestions-item">
        <p class="text">What You should do?</p>
        <span class="icon material-symbols-rounded">code_blocks</span>
    </li>
</ul>

<!-- New Feature Boxes -->

<p class="message-text"></p>

          <div class="chats-container"></div>
          <button id="scroll-to-bottom" class="scroll-arrow" style="display:none; position: fixed; top: 50%; right: 20px;">‚¨áÔ∏è</button>
<div class="prompt-container">
    <div class="prompt-wrapper">
        <form action="#" class="prompt-form">
            <input type="text" placeholder="Ask Zen AI" class="prompt-input" required/>
            <div class="prompt-actions">
                <div class="file-upload-wrapper">
                    <img src="#" class="file-preview"/>
                    <input id="file-input" type="file" accept="image/*,.pdf,.txt,.csv" hidden/>
                    <button type="button" class="file-icon material-symbols-rounded">description</button>
                    <button id="cancel-file-button" type="button" class="material-symbols-rounded">close</button>
                    <button id="add-file-button" type="button" class="material-symbols-rounded">attach_file</button>
                </div>
                <button id="stop-response-button" type="button" class="material-symbols-rounded">stop_circle</button>
                <button id="send-prompt-button" class="material-symbols-rounded">arrow_upward</button>
            </div>
        </form>
        

<select id="model-selector" class="custom-select">
    <option value="gemini">Gemini</option>
    <option value="groq">Groq</option>
   <!-- <option value="chatgpt">ChatGPT</option>-->
</select>

        <button id="theme-toggle-button" class="material-symbols-rounded">light_mode</button>
        <button id="delete-chats-button" class="material-symbols-rounded">delete</button>
    </div>
    
    <button id="scroll-to-bottom" style="display:none; position:fixed; bottom:20px; right:20px;">‚¨áÔ∏è</button>

<style>
     .model-badge {
    display: inline-block;
    background-color: #4e73df; /* Blue color for Gemini */
    color: white;
    padding: 0.3em 0.6em;
    border-radius: 12px;
    font-weight: bold;
    font-size: 14px;
    margin-right: 10px;
}

.model-badge.groq {
    background-color: #28a745; /* Green color for Groq */
}

     /* Ensure body doesn't scroll */
body {
  overflow: hidden;
  margin: 0;
  height: 100vh;
}

.container {
  overflow-y: auto;
  height: 100vh;
  scroll-behavior: smooth;
}


     /* Scroll Arrow Button */
.scroll-arrow {
    display: none;
    font-size: 2rem;
    background-color: transparent;
    border: none;
    color: var(--text-color);
    cursor: pointer;
    transition: opacity 0.3s ease;
}

.scroll-arrow.show {
    display: block;
    opacity: 1;
}

.scroll-arrow.hide {
    opacity: 0;
}

/* Chat Container */
.chats-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    height: calc(100vh - 100px); /* Adjust as needed */
    overflow-y: auto;
    padding: 20px;
    margin-bottom: 50px;
}
      /* Custom Select Styling */
        /* Custom Select Box Styling */
    .custom-select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        padding: 12px 15px;
        font-size: 16px;
        background-color: var(--secondary-color);
        color: var(--text-color);
        border: 2px solid var(--secondary-hover-color);
        border-radius: 8px;
        cursor: pointer;
        transition: border 0.3s ease, background-color 0.3s ease;
        width: 100%;
        max-width: 200px;
    }

    .custom-select:focus {
        outline: none;
        border-color: var(--text-color);
        background-color: var(--secondary-hover-color);
    }

    .custom-select::after {
        content: "‚ñº";
        font-size: 14px;
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        pointer-events: none;
    }

    /* Hide default dropdown arrow */
    .custom-select::-ms-expand {
        display: none;
    }

    /* Style when hovering the select box */
    .custom-select:hover {
        border-color: var(--text-color);
    }

    /* Apply padding for the options */
    .custom-select option {
        padding: 12px;
    }

    /* Custom Styles for Buttons and Forms */
    .prompt-container .prompt-form {
        height: 100%;
        width: 100%;
        border-radius: 130px;
        background-color: var(--secondary-color);
    }

    .prompt-input {
        width: 100%;
        height: 100%;
        background: none;
        color: var(--text-color);
        border: none;
        outline: none;
        font-size: 1rem;
        padding-left: 24px;
    }

    .prompt-input::placeholder {
        color: var(--placeholder-color);
    }

    .prompt-wrapper button {
        width: 56px;
        height: 100%;
        flex-shrink: 0;
        cursor: pointer;
        font-size: 1.4rem;
        border: none;
        border-radius: 50%;
        background-color: var(--secondary-color);
        color: var(--text-color);
        transition: 0.3s ease;
    }

    .prompt-wrapper :is(button:hover, #cancel-file-button, .file-icon) {
        background-color: var(--secondary-hover-color);
    }

    .prompt-form .prompt-actions {
        gap: 5px;
        margin-right: 7px;
    }

    .prompt-form #send-prompt-button {
        background-color: #1d7efd;
        color: #fff;
        display: none;
    }

    .prompt-form .prompt-input:valid~.prompt-actions #send-prompt-button {
        display: block;
    }

    .prompt-form #send-prompt-button:hover {
        background-color: #0264e3;
    }

    /* Responsive Adjustments */
    @media only screen and (max-width: 768px) {
        .container {
            padding: 20px 0px 100px;
        }

        .prompt-form {
            height: 53px;
            padding-left: 20px;
        }

        .prompt-form button {
            width: 50px;
        }
    }


    /* Adjust file input styles */
    #file-input {
        display: none;
    }
    /* Initially hide the attach button */
    #add-file-button {
        display: none;
    }

    /* Show the attach button when Gemini is selected */
    #model-selector[value="gemini"]:checked ~ .prompt-wrapper #add-file-button {
        display: inline-block;
    }

    /* Hide the attach button when Groq is selected */
    #model-selector[value="groq"]:checked ~ .prompt-wrapper #add-file-button {
        display: none;
    }
    .container {
  overflow-x: hidden;
}
.model-badge {
    background: #e0e0e0;
    color: #333;
    font-size: 12px;
    padding: 2px 8px;
    border-radius: 12px;
    display: inline-block;
    margin-bottom: 4px;
    font-weight: 500;
}

.user-header {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 4px;
}

</style>
<script type="text/javascript">
     
</script>

               <p class="disclaimer-text">‡§®‡§µ-Ation ( Zen-AI ) can make mistakes, so double-check it</p>

               <br><p class="disclaimer-text"> By - ‡§®‡§µ-Ation & KaisthaGroups.</p>
          </div>
  
     </div>
   


     <script type="text/javascript">
const container = document.querySelector('.container');
const chatsContainer = document.querySelector('.chats-container');
const promptForm = document.querySelector('.prompt-form');
const promptInput = promptForm.querySelector('.prompt-input');
const fileInput = promptForm.querySelector('#file-input');
const fileUploadWrapper = promptForm.querySelector('.file-upload-wrapper');
const themeToggleButton = document.querySelector('#theme-toggle-button');
const MODEL_SELECTOR = document.getElementById("model-selector");

const GEMINI_API_KEY = 'AIzaSyDwENyzAw96HJJd5lrEilyYv7wPQYVNz68';
const GROQ_API_KEY = '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';

const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;
const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';

const OPENAI_API_KEY = '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';
const OPENAI_API_URL = 'https://api.openai.com/v1/chat/completions';

const chatHistory = [];
const userData = { message: "", file: {} };
const isLightTheme = localStorage.getItem('themeColor') === 'light_mode';
let typingInterval;
let controller;
document.body.classList.toggle("light-theme", isLightTheme);
themeToggleButton.textContent = isLightTheme ? 'dark_mode' : 'light_mode';

const createMessageElement = (content, ...classes) => {
    const div = document.createElement('div');
    div.classList.add('message', ...classes);
    div.innerHTML = content;
    return div;
};

const scrollToBottom = (force = false) => {
    const threshold = 150;
    const isNearBottom = container.scrollHeight - container.scrollTop - container.clientHeight < threshold;

    if (force || isNearBottom) {
        requestAnimationFrame(() => {
            container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
        });
    }
};

const typingEffect = (text, textElement, botMessageDiv) => {
    textElement.textContent = "";
    const words = text.split(" ");
    let wordIndex = 0;
    typingInterval = setInterval(() => {
        if (wordIndex < words.length) {
            textElement.textContent += (wordIndex === 0 ? "" : " ") + words[wordIndex++];
            scrollToBottom();
            setTimeout(scrollToBottom, 100);
        } else {
            clearInterval(typingInterval);
            botMessageDiv.classList.remove('loading');
            document.body.classList.remove('bot-responding');
        }
        const threshold = 100;
        const isNearBottom = container.scrollHeight - container.scrollTop - container.clientHeight < threshold;
        if (isNearBottom) {
            container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
        }
    }, 40);
};

const generateResponse = async (botMessageDiv) => {
    const textElement = botMessageDiv.querySelector('.message-text');
    controller = new AbortController();
    const selectedModel = MODEL_SELECTOR.value;
    try {
        const userMessageLower = userData.message.toLowerCase();
        const specialResponses = {
            "what is your name": "My name is Zen - AI created by ‡§®‡§µ-Ation & Kaistha Groups, trained by Sugam Kaistha.",
            "who are you": "My name is Zen - AI created by ‡§®‡§µ-Ation & Kaistha Groups, trained by Sugam Kaistha.",
            "sugam kaistha": "A man 'Sugam Kaistha' who made Zen - AI Model and many projects.",
            "sugam ": "A man 'Sugam' Full name is 'Sugam Kaistha' who made Zen - AI Model and many projects.",
            "‡§®‡§µ-Ation": "‡§®‡§µ-Ation, ‡§®‡§µ means 'NEW'-& Ation means 'WORK' and it is AI model and it show our Zen AI have new innovation.Trained by Sugam Kaistha. Try it",
            "nav-ation": "‡§®‡§µ-Ation, ‡§®‡§µ means 'NEW'-& Ation means 'WORK' and it is AI model and it show our Zen AI have new innovation.Trained by Sugam Kaistha. Try it",
            "zen ai": "Zen - AI is an advanced model created by Sugam Kaistha and his team ‡§®‡§µ-Ation.",
            "nav ation": "‡§®‡§µ-Ation, ‡§®‡§µ means 'NEW'-& Ation means 'WORK' and it is AI model and it show our Zen AI have new innovation.Trained by Sugam Kaistha. Try it",
            "kaistha groups": "Kaistha Groups is where all AI models, OS, games, education, and more projects exist.",
            "ilovepalakuu": "Hi, Plakuuüëã, ‡§Ø‡•á ‡§§‡•á‡§∞‡§æ shugamüíï, or ‡§î‡§∞ ‡§Ø‡•á ‡§§‡•á‡§∞‡•á shugam  ‡§ï‡§æ aiüòÅ. I love You Palkuu‚ù§Ô∏èüòò, best of luck For your life my jaan ‚ù§Ô∏è.‡§Æ‡•Å‡§ù‡•á ‡§Æ‡§æ‡§´ ‡§ï‡§∞‡§®‡§æ ‡§Ö‡§ó‡§∞ ‡§ï‡§≠‡•Ä ‡§¨‡•Å‡§∞‡§æ ‡§≤‡§ó‡§æ ‡§π‡•ãüòî, Shoory Palkuu ü•π‚ù§Ô∏è ",
            "kgs": "Kaistha Groups is an organization working on various technological advancements."
        };

        for (const key in specialResponses) {
            if (userMessageLower.includes(key)) {
                typingEffect(specialResponses[key], textElement, botMessageDiv);
                return;
            }
        }

        let responseText = "";
        if (selectedModel === "gemini") {
            // Gemini API request
            chatHistory.push({
                role: 'user',
                parts: [{ text: userData.message }, ...(userData.file.data ? [{ inline_data: (({ fileName, isImage, ...rest }) => rest)(userData.file) }] : [])]
            });

            const response = await fetch(GEMINI_API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: chatHistory }),
                signal: controller.signal,
            });

            const data = await response.json();
            if (!response.ok) throw new Error(data.error.message);
            responseText = data.candidates[0].content.parts[0].text.replace(/\*\*([^*]+)\*\*/g, '$1').trim();
            chatHistory.push({ role: 'model', parts: [{ text: responseText }] });

        } else if (selectedModel === "groq") {
            // Groq API request
            const groqMessages = [
                { role: "system", content: "You are a helpful assistant." },
                { role: "user", content: userData.message }
            ];

            const response = await fetch(GROQ_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${GROQ_API_KEY}`
                },
                body: JSON.stringify({
                    model: "llama3-8b-8192", // Adjust based on the actual model you're using
                    messages: groqMessages
                }),
                signal: controller.signal
            });

            const data = await response.json();
            if (!response.ok) throw new Error(data.error.message);
            responseText = data.choices[0].message.content;

        } else if (selectedModel === "chatgpt") {
            // ChatGPT API request
            const openaiMessages = [
                { role: "system", content: "You are a helpful assistant." },
                { role: "user", content: userData.message }
            ];

            const response = await fetch(OPENAI_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify({
                    model: "gpt-3.5-turbo", // Use "gpt-4" if you have access
                    messages: openaiMessages
                }),
                signal: controller.signal
            });

            const data = await response.json();
            if (!response.ok) throw new Error(data.error.message);
            responseText = data.choices[0].message.content.trim();
        }

        // Show response with typing effect
        typingEffect(responseText, textElement, botMessageDiv);

    } catch (error) {
        textElement.textContent = error.name === 'AbortError' ? 'Response generation stopped.' : error.message;
        textElement.style.color = '#d62939';
        botMessageDiv.classList.remove('loading');
        document.body.classList.remove('bot-responding');
        scrollToBottom();
    } finally {
        userData.file = {};
    }
};

const handleFormSubmit = (event) => {
    event.preventDefault();
    const userMessage = promptInput.value.trim();
    if (!userMessage || document.body.classList.contains('bot-responding')) return;
    
    userData.message = userMessage;
    promptInput.value = "";
    document.body.classList.add('chats-active', 'bot-responding');
    fileUploadWrapper.classList.remove('file-attached', 'img-attached', 'active');

    // Get the selected model from the dropdown
    const selectedModel = MODEL_SELECTOR.value;
    
    // Corrected logic for determining the model badge
    const modelUsed = selectedModel === 'gemini' ? 'üîç Gemini' : 'üîç Groq';

    // Create user message HTML
    const userMsgHTML = `
        <div class="user-header">
            <span class="model-badge">${modelUsed}</span>
        </div>
        <p class="message-text"></p>
        ${userData.file.data ? (userData.file.isImage ? `<img src="data:${userData.file.mime_type};base64,${userData.file.data}" class="image-attachment" />` : `<p class="file-attachment"><span class="material-symbols-rounded">description</span>${userData.file.fileName}</p>`) : ""}
    `;
    
    // Create the user message div and append to the chats container
    const userMsgDiv = createMessageElement(userMsgHTML, 'user-message');
    userMsgDiv.querySelector('.message-text').textContent = userData.message;
    chatsContainer.appendChild(userMsgDiv);
    scrollToBottom();

    setTimeout(() => {
        const botMessageHTML = `<img class='avatar' src='https://sugamimage.carrd.co/assets/images/image36.png?v=f7f20d18'/><p class='message-text'>Thinking...</p>`;
        const botMessageDiv = createMessageElement(botMessageHTML,'bot-message','loading');
        chatsContainer.appendChild(botMessageDiv);
        scrollToBottom();
        generateResponse(botMessageDiv);
    }, 600);
};

promptForm.addEventListener('submit', handleFormSubmit);

fileInput.addEventListener('change', () => {
    const file = fileInput.files[0];
    if (!file) return;
    if (file.size > 5 * 1024 * 1024) {
        alert("File too large. Please upload files smaller than 5MB.");
        return;
    }

    const isImage = file.type.startsWith('image/');
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = (event) => {
        fileInput.value = "";
        const base64String = event.target.result.split(',')[1];
        fileUploadWrapper.querySelector('.file-preview').src = event.target.result;
        fileUploadWrapper.classList.add('active', isImage ? 'image-attached' : 'file-attached');
        userData.file = { fileName: file.name, data: base64String, mime_type: file.type, isImage };
    };
    promptForm.dispatchEvent(new Event('submit'));
    if (document.body.classList.contains('bot-responding')) return;
});

document.querySelector('#cancel-file-button').addEventListener('click', () => {
    userData.file = {};
    fileUploadWrapper.classList.remove('file-attached', 'image-attached', 'active');
});

document.querySelector('#stop-response-button').addEventListener('click', () => {
    controller?.abort();
    userData.file = {};
    clearInterval(typingInterval);
    chatsContainer.querySelector('.bot-message.loading').classList.remove('loading');
    document.body.classList.remove("bot-responding");
});

themeToggleButton.addEventListener('click', () => {
    const isLightTheme = document.body.classList.toggle('light-theme');
    localStorage.setItem('themeColor', isLightTheme ? 'light_mode' : 'dark_mode');
    themeToggleButton.textContent = isLightTheme ? 'dark_mode' : 'light_mode';
});

document.querySelector('#delete-chats-button').addEventListener('click', () => {
    chatHistory.length = 0;
    chatsContainer.innerHTML = "";
    document.body.classList.remove('chats-active', 'bot-responding');
});

document.querySelectorAll('.suggestions-item').forEach((suggestion) => {
    suggestion.addEventListener('click', () => {
        promptInput.value = suggestion.querySelector('.text').textContent;
        promptForm.dispatchEvent(new Event('submit'));
    });
});

document.addEventListener('click', ({ target }) => {
    const wrapper = document.querySelector('.prompt-wrapper');
    const shouldHide = target.classList.contains('prompt-input') || (wrapper.classList.contains('hide-controls') && (target.id === 'add-file-button' || target.id === 'stop-response-button'));
    wrapper.classList.toggle("hide-controls", shouldHide);
});

promptForm.querySelector('#add-file-button').addEventListener('click', () => fileInput.click());

     </script>
</body>
</html>
